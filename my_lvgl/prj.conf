# =====================================================
# 目标：ST7789 + LVGL 显示，手机经 BLE/NUS 写入时间并显示
# 路线：Zephyr 显示子系统（推荐，不与 LVGL 内置驱动混用）
# =====================================================

# -------------------------
# 基础系统 / 内存 / 日志
# -------------------------


# 让内核能报出哪个线程、并更早发现栈问题
CONFIG_THREAD_NAME=y
CONFIG_THREAD_STACK_INFO=y
CONFIG_INIT_STACKS=y
CONFIG_STACK_SENTINEL=y
CONFIG_ASSERT=y
CONFIG_HW_STACK_PROTECTION=y      # 硬件栈保护（MPU）
CONFIG_THREAD_MONITOR=y          # 线程监控（可选）
# 系统工作队列（很多驱动会用到）
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048

CONFIG_MAIN_STACK_SIZE=16384
CONFIG_HEAP_MEM_POOL_SIZE=16384

CONFIG_LOG=y
# 如需串口 Shell 调试再打开
# CONFIG_SHELL=y

# POSIX 时间：clock_settime()/clock_gettime()
CONFIG_POSIX_CLOCK=y
CONFIG_NEWLIB_LIBC=y

CONFIG_POSIX_API=y

# CST816S
CONFIG_INPUT_CST816S_INTERRUPT=y
# -------------------------
# 硬件驱动（按你的接法启用）
# -------------------------
CONFIG_GPIO=y
CONFIG_SPI=y                 # ST7789 常用 SPI
CONFIG_PWM=y                 # 若背光用 PWM；不用可注释
CONFIG_INPUT=y             # 有触摸/按键扫描再打开

# -------------------------
# 显示子系统 + LVGL（Zephyr 路径）
# -------------------------
CONFIG_DISPLAY=y
CONFIG_DISPLAY_LOG_LEVEL_ERR=y

CONFIG_LVGL=y
CONFIG_LV_USE_LOG=y
CONFIG_LV_COLOR_DEPTH_16=y
CONFIG_LV_COLOR_16_SWAP=y

# Zephyr↔LVGL 集成
CONFIG_LV_Z_MEM_POOL_SIZE=65536
CONFIG_LV_Z_POINTER_INPUT=y   # 若没有输入设备，可注释掉
CONFIG_LV_USE_PRIVATE_API=y
CONFIG_LV_Z_FLUSH_THREAD=y
# 字体（按需保留，过多会增体积）
CONFIG_LV_FONT_MONTSERRAT_14=y
CONFIG_LV_FONT_MONTSERRAT_18=y
# 开发期调试工具（量产建议关闭）
# CONFIG_LV_USE_SYSMON is not set
# CONFIG_LV_USE_PERF_MONITOR is not set

CONFIG_LV_Z_FLUSH_THREAD_STACK_SIZE=3072

CONFIG_SENSOR=y
#CONFIG_BMI270=y
# ST7789 驱动本体（部分版本会自动根据 DTS 打开，这里显式置 y 更稳）
CONFIG_ST7789V=y
# 若你的工程确实需要该宏（部分派生驱动才有），再保留：
CONFIG_ST7789V_RGB565=y

# -------------------------
# 蓝牙（NUS 对时）
# -------------------------
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_GATT_SERVICE_CHANGED=y

CONFIG_BT_ZEPHYR_NUS=y

# 安全与配对（建议开启；配合 SETTINGS 保存绑定）
CONFIG_BT_SMP=y
CONFIG_BT_SETTINGS=y
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y

# 设备名
CONFIG_BT_DEVICE_NAME="NUS-TimeSync"
# CONFIG_BT_DEVICE_APPEARANCE=0
# 可选链路优化（更长数据包/更高 PHY）
# CONFIG_BT_USER_PHY_UPDATE=y
# CONFIG_BT_USER_DATA_LEN_UPDATE=y

# -------------------------
# zbus（可选，用于 BLE 与 UI/时钟模块解耦）
# -------------------------
CONFIG_ZBUS=y
# 下面这些是调试/可观测性增强，会增体积，默认关闭
CONFIG_ZBUS_RUNTIME_OBSERVERS=y
CONFIG_ZBUS_CHANNEL_NAME=y
CONFIG_ZBUS_OBSERVER_NAME=y
CONFIG_ZBUS_CHANNELS_SYS_INIT_PRIORITY=1

